<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baduk Analysis</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@900&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <Style>
    body {
      background-color: #00FF00;
    }

    .information {
      display: flex;
      justify-content: space-between;
      /* This will align children to the edges */
      align-items: center;
      width: 524px;
    }

    .vertical {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      /* Align text to the left for black player */
      flex: 1;
    }

    .vertical.right-aligned {
      align-items: flex-end;
      /* Align text to the right for white player */
    }


    .winrate {
      position: relative;
      width: 75px;
      height: 75px;

    }

    #pie {
      width: 100%;
      height: 100%;
      background-image: conic-gradient(rgb(233, 233, 233) 56%, black 44%);
      border-radius: 100%
    }

    #pie-over {
      position: absolute;
      top: 8%;
      /* top edge */
      left: 8%;
      /* left edge */
      width: 84%;
      height: 84%;
      background-color: grey;
      border-radius: 50%;
    }

    #pie-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Roboto', sans-serif;
      font-size: 28px;
      color: white;

    }

    .vertical span,
    .vertical text {
      margin: 5px 0;
    }

    .clock {
      font-size: 32px;
    }

    #player-name,
    #white-name,
    #white-clock {
      padding-right: 4px;
      font-family: 'Roboto', sans-serif;
      font-size: 26px;
      font-weight: 900;
      -webkit-text-stroke: 1px black;
      text-shadow:
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000;
      color: white;
    }

    #player-name,
    #black-name,
    #black-clock {
      padding-left: 4px;
      font-family: 'Roboto', sans-serif;
      font-size: 26px;
      font-weight: 900;
      -webkit-text-stroke: 1px white;
      text-shadow:
        -1px -1px 0 #ffffff,
        1px -1px 0 #ffffff,
        -1px 1px 0 #ffffff,
        1px 1px 0 #ffffff;
      color: black;
    }

    #black-clock,
    #white-clock {
      font-size: 32px;
    }

    .goboard {
      width: 524px;
      height: 524px;
      background-image: url(https://ai-sensei.com/img/kaya14d.jpg);

    }

    .counting {
      margin-top: 2px;
      position: relative;
      /* Establishes a positioning context */
      width: 521px;
      height: 38px;
      border: 3px solid black;
      border-radius: 5px 5px 5px 5px;
      overflow: hidden;

    }

    #black-points,
    #white-points {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      /* Centers the text vertically */
    }

    #black-points {
      left: 30px;
      font-family: 'Roboto', sans-serif;
      font-size: 32px;
      font-weight: 900;
      -webkit-text-stroke: 1px white;
      text-shadow:
        -2px -2px 0 #ffffff,
        2px -2px 0 #ffffff,
        -2px 2px 0 #ffffff,
        2px 2px 0 #ffffff;
      color: black;
    }

    #white-points {
      right: 30px;
      text-align: right;
      font-family: 'Roboto', sans-serif;
      font-size: 32px;
      -webkit-text-stroke: 1px black;
      text-shadow:
        -2px -2px 0 #000,
        2px -2px 0 #000,
        -2px 2px 0 #000,
        2px 2px 0 #000;
      color: white;
    }
  </Style>
</head>

<body>
  <div class="information border-class">
    <div class="vertical">
      <span id="black-clock" class="clock">00:00</span>
      <text id="black-name" class="player-name">Black Player</text> <!-- Corrected the class name -->
    </div>
    <div class="winrate">
      <div id="pie"></div>
      <div id="pie-over"></div>
      <text id="pie-text">56%</text>
    </div>
    <div class="vertical right-aligned">
      <span id="white-clock" class="clock">00:00</span>
      <text id="white-name" class="player-name">White Player</text> <!-- Corrected the class name -->
    </div>
  </div>

  <div class="goboard" class="border-class">
  </div>
  <div class="counting" class="border-class">
    <text id="black-points">117</text>
    <text id="white-points">121</text>
  </div>
  <script>
    // const socket = io("http://localhost:2468");
    const elements = {
      clock: {
        black: document.getElementById("black-clock"),
        white: document.getElementById("white-clock")
      },
      names: {
        black: document.getElementById("black-name"),
        white: document.getElementById("white-name")
      },
      winrate: {
        pie: document.getElementById("pie"),
        over: document.getElementById("pie-over"),
        text: document.getElementById("pie-text")
      },
      confidence: {
        text: {
          black: document.getElementById("black-points"),
          white: document.getElementById("white-points")
        }
      }
    }

    const svgNS = "http://www.w3.org/2000/svg";
    const BOARD_SIZE = 19;
    const OFFSET = 50;
    const GRID_SIZE = 800;
    const CELL_SIZE = GRID_SIZE / (BOARD_SIZE - 1);
    const VIEWBOX_SIZE = GRID_SIZE + 2 * OFFSET;
    const BLACK_IMAGE = new Image();
    const WHITE_IMAGE = new Image();
    const BOARD_IMAGE = new Image();
    const BOARD = BOARD_IMAGE.src = 'https://ai-sensei.com/img/kaya14d.jpg'
    const BLACK = BLACK_IMAGE.src = 'https://ai-sensei.com/img/black_small.png'
    const WHITE = WHITE_IMAGE.src = 'https://ai-sensei.com/img/white_small.png'

    const Display = {}

    function createGoBoardSVG() {
      const svgNS = "http://www.w3.org/2000/svg";
      const boardSize = 19;
      const offset = 50; // Space for labels
      const gridSize = 600; // Size of the grid for simplicity
      const viewBoxSize = gridSize + 2 * offset;
      const cellSize = gridSize / (boardSize - 1);

      // Create SVG element
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttributeNS(null, "viewBox", `0 0 ${viewBoxSize} ${viewBoxSize}`);
      svg.setAttributeNS(null, "class", "board");
      svg.setAttributeNS(null, "id", "board"); // Add this line
      svg.style.overflow = "visible";
      svg.style.width = '100%'; // Make it responsive
      svg.style.height = '100%'; // Make it responsive

      // Draw the board background
      const boardBackground = document.createElementNS(svgNS, "rect");
      boardBackground.setAttributeNS(null, "x", offset);
      boardBackground.setAttributeNS(null, "y", offset);
      boardBackground.setAttributeNS(null, "width", gridSize);
      boardBackground.setAttributeNS(null, "height", gridSize);
      boardBackground.setAttributeNS(null, "fill", "rgba(0, 0, 0, 0.05)");
      svg.appendChild(boardBackground);

      // Create the group for labels and lines
      const labelGroup = document.createElementNS(svgNS, "g");
      labelGroup.setAttributeNS(null, "class", "label");
      svg.appendChild(labelGroup);

      const linesGroup = document.createElementNS(svgNS, "g");
      linesGroup.setAttributeNS(null, "class", "lines");
      svg.appendChild(linesGroup);

      // Draw the lines of the board
      for (let i = 0; i < boardSize; i++) {
        const pos = offset + i * cellSize;

        // Horizontal line
        const hLine = document.createElementNS(svgNS, "line");
        hLine.setAttributeNS(null, "x1", offset);
        hLine.setAttributeNS(null, "y1", pos);
        hLine.setAttributeNS(null, "x2", offset + gridSize);
        hLine.setAttributeNS(null, "y2", pos);
        hLine.setAttributeNS(null, "stroke", "#000");
        linesGroup.appendChild(hLine);

        // Vertical line
        const vLine = document.createElementNS(svgNS, "line");
        vLine.setAttributeNS(null, "x1", pos);
        vLine.setAttributeNS(null, "y1", offset);
        vLine.setAttributeNS(null, "x2", pos);
        vLine.setAttributeNS(null, "y2", offset + gridSize);
        vLine.setAttributeNS(null, "stroke", "#000");
        linesGroup.appendChild(vLine);
      }

      // Add star points
      const starPoints = [
        { x: 3, y: 3 }, { x: 9, y: 3 }, { x: 15, y: 3 },
        { x: 3, y: 9 }, { x: 9, y: 9 }, { x: 15, y: 9 },
        { x: 3, y: 15 }, { x: 9, y: 15 }, { x: 15, y: 15 },
      ];
      starPoints.forEach(point => {
        const circle = document.createElementNS(svgNS, "circle");
        circle.setAttributeNS(null, "cx", offset + point.x * cellSize);
        circle.setAttributeNS(null, "cy", offset + point.y * cellSize);
        circle.setAttributeNS(null, "r", 5);
        circle.setAttributeNS(null, "fill", "#000");
        svg.appendChild(circle);
      });

      // Add labels
      for (let i = 0; i < boardSize; i++) {
        const pos = offset + i * cellSize;
        const number = boardSize - i;
        const letter = String.fromCharCode('A'.charCodeAt(0) + (i >= 8 ? i + 1 : i)); // Skip 'I'

        // Top letters
        const topText = document.createElementNS(svgNS, "text");
        topText.setAttributeNS(null, "x", pos);
        topText.setAttributeNS(null, "y", offset / 2);
        topText.setAttributeNS(null, "font-size", "21");
        topText.setAttributeNS(null, "text-anchor", "middle");
        topText.setAttributeNS(null, "dy", "0.35em");
        topText.setAttributeNS(null, "stroke", "#080808");
        topText.setAttributeNS(null, "fill", "#080808");
        topText.textContent = letter;
        labelGroup.appendChild(topText);

        // Bottom letters
        const bottomText = topText.cloneNode(true);
        bottomText.setAttributeNS(null, "y", viewBoxSize - offset / 2);
        labelGroup.appendChild(bottomText);

        // Side numbers
        const sideNumberLeft = document.createElementNS(svgNS, "text");
        sideNumberLeft.setAttributeNS(null, "x", offset / 2);
        sideNumberLeft.setAttributeNS(null, "y", pos);
        sideNumberLeft.setAttributeNS(null, "font-size", "21");
        sideNumberLeft.setAttributeNS(null, "text-anchor", "middle");
        sideNumberLeft.setAttributeNS(null, "dy", "0.35em");
        sideNumberLeft.setAttributeNS(null, "stroke", "#080808");
        sideNumberLeft.setAttributeNS(null, "fill", "#080808");
        sideNumberLeft.textContent = number;
        labelGroup.appendChild(sideNumberLeft);

        const sideNumberRight = sideNumberLeft.cloneNode(true);
        sideNumberRight.setAttributeNS(null, "x", viewBoxSize - offset / 2);
        labelGroup.appendChild(sideNumberRight);
      }


      const stonesGroup = document.createElementNS(svgNS, 'g');
      stonesGroup.setAttributeNS(null, 'id', 'stonesGroup');
      svg.appendChild(stonesGroup);

      // Create placeholder stones for each intersection
      for (let i = 0; i < boardSize; i++) {
        for (let j = 0; j < boardSize; j++) {
          const posX = offset + i * cellSize;
          const posY = offset + j * cellSize;
          const stonePlaceholder = document.createElementNS(svgNS, 'image');

          stonePlaceholder.setAttributeNS(null, 'x', posX - cellSize / 2 * 0.99);
          stonePlaceholder.setAttributeNS(null, 'y', posY - cellSize / 2 * 0.99);
          stonePlaceholder.setAttributeNS(null, 'width', cellSize * 0.99);
          stonePlaceholder.setAttributeNS(null, 'height', cellSize * 0.99);
          stonePlaceholder.setAttributeNS('http://www.w3.org/1999/xlink', 'href', ''); // Empty href at first
          stonePlaceholder.setAttributeNS(null, 'id', `stone-${i}-${j}`); // ID based on position

          stonesGroup.appendChild(stonePlaceholder);
        }
      }

      const boardContainer = document.querySelector('.goboard');
      boardContainer.innerHTML = ''; // Clear any existing content
      boardContainer.appendChild(svg);
    }


    function createScoreBar() {
      const svgNS = "http://www.w3.org/2000/svg";
      const width = 524;
      const height = 38;
      const totalBoxes = 10;
      const dashWidth = 3; // Width of the dash

      // Create the main SVG element
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttributeNS(null, "width", "100%");
      svg.setAttributeNS(null, "height", "100%");

      // Create a group for black points
      const blackGroup = document.createElementNS(svgNS, "g");
      svg.appendChild(blackGroup);

      // Create a group for white points
      const whiteGroup = document.createElementNS(svgNS, "g");
      svg.appendChild(whiteGroup);

      // Calculate box width based on the total width and number of boxes
      const boxWidth = width / totalBoxes;

      // Generate black points from left to right (1 to 0.1)
      for (let i = totalBoxes - 1; i >= 0; i--) {
        const box = document.createElementNS(svgNS, "rect");
        box.setAttributeNS(null, "x", i * 0);
        box.setAttributeNS(null, "y", 0);
        box.setAttributeNS(null, "width", 0);
        box.setAttributeNS(null, "height", height);
        box.setAttributeNS(null, "id", `black-points-${i + 1}`)

        let value
        let modularI = i%10
        if (modularI >= 7 && modularI <= 10) {
          value = 1;
        } else if (modularI >= 4 && modularI <= 7) {
          value = 0.95;
        } else if (modularI >= 1 && modularI <= 4) {
          value = 0.85;
        } else {
          value = 0.75;
        }



        const aiScore = value;
        const fillColor = `rgba(${10 * value}, ${10 * value}, ${10 * value}, ${aiScore})`;
        box.setAttributeNS(null, "fill", fillColor);

        blackGroup.appendChild(box);
      }

      // Generate white points from right to left (1 to 0.1)
      for (let i = 0; i < totalBoxes; i++) {
        const box = document.createElementNS(svgNS, "rect");
        box.setAttributeNS(null, "x", (totalBoxes - i - 1) * 0);
        box.setAttributeNS(null, "y", 0);
        box.setAttributeNS(null, "width", 0);
        box.setAttributeNS(null, "height", height);
        box.setAttributeNS(null, "id", `white-points-${i + 1}`)

        let value
        if (i >= 7 && i <= 10) {
          value = 1;
        } else if (i >= 4 && i <= 7) {
          value = 0.95;
        } else if (i >= 1 && i <= 4) {
          value = 0.85;
        } else {
          value = 0.74;
        }

        const aiScore = value;
        const fillColor = `rgba(${235 * value}, ${235 * value}, ${235 * value}, ${aiScore})`;
        box.setAttributeNS(null, "fill", fillColor);

        whiteGroup.appendChild(box);
      }


      // Create a center dashed line
      const centerDashLine = document.createElementNS(svgNS, "line");
      centerDashLine.setAttributeNS(null, "x1", width / 2);
      centerDashLine.setAttributeNS(null, "y1", 0);
      centerDashLine.setAttributeNS(null, "x2", width / 2);
      centerDashLine.setAttributeNS(null, "y2", height);
      centerDashLine.setAttributeNS(null, "stroke", "black");
      centerDashLine.setAttributeNS(null, "stroke-width", "3px");
      centerDashLine.setAttributeNS(null, "stroke-dasharray", "3");
      svg.appendChild(centerDashLine);

      // Append the SVG to the document or a container element
      const counteingContainer = document.querySelector('.counting');
      counteingContainer.appendChild(svg);
    }

    function addStone(x, y, color) {

      const stoneId = `stone-${x}-${y}`;
      const stone = document.getElementById(stoneId);
      stone.setAttributeNS('http://www.w3.org/1999/xlink', 'href', color);
    }

    // Function to remove a stone
    function removeStone(x, y) {
      const stoneId = `stone-${x}-${y}`;
      const stone = document.getElementById(stoneId);
      stone.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '');
    }

    function setScoreBar(blackScores, whiteScores) {
      const boxWidth = 524;
      const height = 38;

      let blackTotal = 0;
      let whiteTotal = 0;

      // Update black scores
      for (let i = 10; i >= 1; i--) {
        const rect = document.getElementById(`black-points-${i}`);
        const score = blackScores[i - 1];
        const width = (score / 368) * boxWidth;
        rect.setAttribute('width', width + 0.1);
        rect.setAttribute('x', blackTotal);
        blackTotal += width; // Adjusted here
      }

      // Update white scores
      for (let i = 10; i >= 1; i--) {
        const rect = document.getElementById(`white-points-${i}`);
        const score = whiteScores[i - 1];
        const width = (score / 368) * boxWidth;
        const xPosition = boxWidth - whiteTotal - width + 1; // Adjusted here
        rect.setAttribute('width', width);
        rect.setAttribute('x', xPosition);
        whiteTotal += width; // Adjusted here
      }

      elements.confidence.text.black.innerText = blackScores.reduce((accumulator, currentValue) => accumulator + currentValue, 0);
      elements.confidence.text.white.innerText = whiteScores.reduce((accumulator, currentValue) => accumulator + currentValue, 0);

    }

    document.addEventListener("DOMContentLoaded", function () {
      createGoBoardSVG();
      createScoreBar();

      // Wait for the next 'tick' to ensure the SVG is fully loaded
      setTimeout(function () {
        // Add a black stone at position (3, 3)
        addStone(3, 3, BLACK);
        addStone(2, 5, BLACK);
        addStone(15, 3, BLACK);

        // Add a white stone at position (16, 16)
        addStone(15, 15, WHITE);
        addStone(3, 15, WHITE);
        addStone(3, 6, WHITE);
        removeStone(4, 3);
      }, 0);

      // Call setScoreBar after a short delay to ensure the SVG is fully loaded
      setTimeout(function () {
        function randomlyGenerate10() {
          let numbers = [];

          for (let i = 0; i < 10; i++) {
            // Generate a random number between 1 and 20
            let randomNumber = Math.floor(Math.random() * 20) + 1;

            // Add the random number to the array
            numbers.push(randomNumber);
          }

          return numbers;
        }

        const blackP = randomlyGenerate10();
        const whiteP = randomlyGenerate10();
        setScoreBar(blackP, whiteP);
      }, 100); // Adjust the delay as needed
    });




  </script>

</body>

</html>